-- Database: simba

-- Tabel user
CREATE TABLE IF NOT EXISTS `user` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `nama` varchar(255) NOT NULL,
  `nik` char(16) NOT NULL,
  `password` varchar(255) NOT NULL,
  `role` enum('admin','user') NOT NULL DEFAULT 'user',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `nik` (`nik`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Tabel pengajuan
CREATE TABLE IF NOT EXISTS `pengajuan` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_user` int(11) NOT NULL,
  `nik` varchar(16) NOT NULL,
  `no_kk` varchar(16) NOT NULL,
  `nama_lengkap` varchar(255) NOT NULL,
  `alamat` text NOT NULL,
  `no_hp` varchar(15) NOT NULL,
  `gaji` decimal(15,2) NOT NULL,
  `status_rumah` enum('Milik Sendiri','Sewa','Menumpang','Lainnya') NOT NULL,
  `daya_listrik` int(11) NOT NULL,
  `pengeluaran` decimal(15,2) NOT NULL,
  `jml_keluarga` int(11) NOT NULL,
  `jml_anak_sekolah` int(11) NOT NULL,
  `status` enum('Menunggu Verifikasi','Sedang Diverifikasi','Terverifikasi','Ditolak') NOT NULL DEFAULT 'Menunggu Verifikasi',
  `tanggal_dibuat` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `id_user` (`id_user`),
  CONSTRAINT `pengajuan_ibfk_1` FOREIGN KEY (`id_user`) REFERENCES `user` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Tabel dokumen
CREATE TABLE IF NOT EXISTS `dokumen` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_pengajuan` int(11) NOT NULL,
  `ktp` varchar(255) DEFAULT NULL,
  `kk` varchar(255) DEFAULT NULL,
  `slip_gaji` varchar(255) DEFAULT NULL,
  `foto_rumah` varchar(255) DEFAULT NULL,
  `surat_keterangan_rumah` varchar(255) DEFAULT NULL,
  `rekening_listrik` varchar(255) DEFAULT NULL,
  `daftar_pengeluaran` varchar(255) DEFAULT NULL,
  `kartu_pelajar_anak` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `id_pengajuan` (`id_pengajuan`),
  CONSTRAINT `dokumen_ibfk_1` FOREIGN KEY (`id_pengajuan`) REFERENCES `pengajuan` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Tabel verifikasi
CREATE TABLE IF NOT EXISTS `verifikasi` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_pengajuan` int(11) NOT NULL,
  `id_petugas` int(11) NOT NULL,
  `tanggal` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `status` enum('Layak','Tidak Layak','Perlu Perbaikan') NOT NULL,
  `catatan` text,
  PRIMARY KEY (`id`),
  KEY `id_pengajuan` (`id_pengajuan`),
  KEY `id_petugas` (`id_petugas`),
  CONSTRAINT `verifikasi_ibfk_1` FOREIGN KEY (`id_pengajuan`) REFERENCES `pengajuan` (`id`) ON DELETE CASCADE,
  CONSTRAINT `verifikasi_ibfk_2` FOREIGN KEY (`id_petugas`) REFERENCES `user` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Tabel kriteria (untuk referensi SAW)
CREATE TABLE IF NOT EXISTS `kriteria` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `nama` varchar(100) NOT NULL,
  `tipe` enum('benefit','cost') NOT NULL,
  `bobot` decimal(5,2) NOT NULL,
  `keterangan` text,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Insert kriteria sesuai penelitian
INSERT INTO `kriteria` (`nama`, `tipe`, `bobot`, `keterangan`) VALUES
('Penghasilan', 'cost', 0.25, 'Pendapatan per bulan. Semakin rendah, semakin prioritas'),
('Status Rumah', 'cost', 0.15, 'Kepemilikan rumah. Menumpang/Sewa lebih prioritas'),
('Daya Listrik', 'cost', 0.15, 'Daya listrik rumah. Semakin rendah, semakin prioritas'),
('Pengeluaran', 'cost', 0.20, 'Pengeluaran per bulan. Semakin tinggi, semakin prioritas'),
('Jumlah Keluarga', 'benefit', 0.15, 'Jumlah anggota keluarga. Semakin banyak, semakin prioritas'),
('Anak Usia Sekolah', 'benefit', 0.10, 'Jumlah anak usia sekolah. Semakin banyak, semakin prioritas');

-- Tabel total_nilai (hasil perhitungan SAW)
CREATE TABLE IF NOT EXISTS `total_nilai` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_pengajuan` int(11) NOT NULL,
  `skor_total` decimal(10,4) NOT NULL,
  `peringkat` int(11) DEFAULT NULL,
  `tanggal_hitung` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `id_pengajuan` (`id_pengajuan`),
  CONSTRAINT `total_nilai_ibfk_1` FOREIGN KEY (`id_pengajuan`) REFERENCES `pengajuan` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Tabel log_perhitungan (untuk tracking perhitungan SAW)
CREATE TABLE IF NOT EXISTS `log_perhitungan` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `tanggal` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `jumlah_data` int(11) NOT NULL,
  `keterangan` text,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;